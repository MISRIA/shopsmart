{% extends "base.html" %}

{% block content %}
<div class="row">
    <!-- Filters Sidebar -->
    <div class="col-md-2 bg-white p-3 border-end">
        <h5 class="fw-bold mb-3">Filters</h5>

        <h6 class="fw-bold">Categories</h6>
        <div class="list-group list-group-flush mb-4 small">
            <a href="{{ url_for('main.products') }}"
                class="list-group-item list-group-item-action border-0 ps-0 {{ 'fw-bold text-dark' if not current_category or current_category == 'All' else 'text-muted' }}">
                All Departments
            </a>
            {% for cat in ['Electronics', 'Fashion', 'Toys'] %}
            <a href="{{ url_for('main.products', category=cat) }}"
                class="list-group-item list-group-item-action border-0 ps-0 {{ 'fw-bold text-dark' if current_category == cat else 'text-muted' }}">
                {{ cat }}
            </a>
            {% endfor %}
        </div>
        <!-- ... other filters ... -->
    </div>

    <!-- Results -->
    <div class="col-md-10 p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Results <span class="text-muted fs-6">({{ products.total }} items)</span></h5>
            <select class="form-select w-auto form-select-sm shadow-sm" id="sort-select" onchange="applySort()">
                <option value="" {{ 'selected' if not current_sort }}>Featured</option>
                <option value="price_asc" {{ 'selected' if current_sort=='price_asc' }}>Price: Low to High</option>
                <option value="price_desc" {{ 'selected' if current_sort=='price_desc' }}>Price: High to Low</option>
            </select>
        </div>

        <script>
            function applySort() {
                const sortVal = document.getElementById('sort-select').value;
                const url = new URL(window.location.href);
                if (sortVal) {
                    url.searchParams.set('sort', sortVal);
                } else {
                    url.searchParams.delete('sort');
                }
                window.location.href = url.toString();
            }
        </script>

        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3 mb-4">
            {% for product in products.items %}
            <div class="col">
                <div class="card h-100 product-card border-0 shadow-sm">
                    <div class="position-relative"
                        style="height: 200px; background-color: #f7f7f7; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        <img src="{{ product.image_url or 'https://via.placeholder.com/150' }}" class="card-img-top p-3"
                            alt="{{ product.name }}" style="max-height: 100%; width: auto;">
                    </div>
                    <div class="card-body p-3">
                        <h6 class="card-title text-truncate mb-1"><a
                                href="{{ url_for('main.product_detail', id=product.id) }}"
                                class="text-dark text-decoration-none">{{ product.name }}</a></h6>
                        <div class="mb-1 small">
                            <span class="text-warning">
                                <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                    class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                    class="fa-solid fa-star-half-stroke"></i>
                            </span>
                        </div>
                        <h5 class="card-text fw-bold mb-1">${{ product.price }}</h5>
                        <p class="small text-muted mb-2 lh-1" style="font-size: 0.8rem;">Get it by
                            <strong>Tomorrow</strong>
                        </p>
                        <form action="{{ url_for('main.add_to_cart', id=product.id) }}" method="POST">
                            <button class="btn btn-warning w-100 btn-sm rounded-pill">Add to Cart</button>
                        </form>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12 text-center py-5">
                <h3>No products found in this category.</h3>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.pages > 1 %}
        <nav>
            <ul class="pagination justify-content-center">
                <li class="page-item {{ 'disabled' if not products.has_prev else '' }}">
                    <a class="page-link text-dark"
                        href="{{ url_for('main.products', page=products.prev_num, category=request.args.get('category')) }}">Previous</a>
                </li>
                {% for page_num in products.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page_num %}
                <li class="page-item {{ 'active' if page_num == products.page else '' }}">
                    <a class="page-link {{ 'bg-warning border-warning text-dark' if page_num == products.page else 'text-dark' }}"
                        href="{{ url_for('main.products', page=page_num, category=request.args.get('category')) }}">{{
                        page_num }}</a>
                </li>
                {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}
                {% endfor %}
                <li class="page-item {{ 'disabled' if not products.has_next else '' }}">
                    <a class="page-link text-dark"
                        href="{{ url_for('main.products', page=products.next_num, category=request.args.get('category')) }}">Next</a>
                </li>
            </ul>
        </nav>
        {% endif %}
    </div>
</div>
{% endblock %}